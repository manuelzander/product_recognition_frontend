language: python
python:
  - 3.6

cache:
  directories:
    - ~/.npm
    - node_modules

before_install:
  - nvm install 6.11
  - nvm use 6.11

# install dependencies
install:
  - npm install
  - pip install -r requirements/dev.txt

# this needs to be running before the tests are run
pre_script:
  - echo 'Initiating flask app'
  - directory_location.sh

script:
  - export FLASK_APP=webcam-example/app.py
  - flask run
  - wait-on http://127.0.0.1:5000/
  - echo 'Running on http://127.0.0.1:5000/'
  - $(npm bin)/cypress run --spec /cypress/integration/index_spec.js
  - sleep 5 # give time to completely finish off

deploy:
  skip_cleanup: true